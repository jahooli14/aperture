<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA Reinstall Instructions</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, -apple-system, sans-serif;
      background: #0f1729;
      color: #fff;
      line-height: 1.6;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    h1 {
      color: #3b82f6;
      margin-bottom: 20px;
    }
    .section {
      background: rgba(59, 130, 246, 0.1);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .step {
      margin: 15px 0;
      padding-left: 30px;
      position: relative;
    }
    .step:before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      color: #3b82f6;
      font-weight: bold;
    }
    code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 14px;
    }
    .warning {
      background: rgba(239, 68, 68, 0.1);
      border-left: 4px solid #ef4444;
      padding: 15px;
      margin: 20px 0;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background: #2563eb;
    }
    .info {
      background: rgba(34, 197, 94, 0.1);
      border-left: 4px solid #22c55e;
      padding: 15px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîÑ PWA Share Target Not Working?</h1>

    <div class="warning">
      <strong>Why this is needed:</strong> When we update the PWA manifest (specifically the <code>share_target</code> configuration), your device's OS needs to re-register the app to pick up the changes. Simply refreshing the page won't work.
    </div>

    <div class="section">
      <h2>Android Chrome/Edge</h2>
      <div class="step">Open Chrome Settings (three dots menu)</div>
      <div class="step">Go to "Apps" ‚Üí "Manage apps"</div>
      <div class="step">Find "Clandestined" and tap it</div>
      <div class="step">Tap "Uninstall"</div>
      <div class="step">Go back to the website and reinstall the PWA</div>
      <div class="step">You should see the install prompt or look for "Add to Home Screen" in the menu</div>
    </div>

    <div class="section">
      <h2>iOS Safari</h2>
      <div class="step">Find the Clandestined app icon on your home screen</div>
      <div class="step">Long press and select "Remove App" ‚Üí "Delete App"</div>
      <div class="step">Go back to Safari and visit the website</div>
      <div class="step">Tap the Share button (square with arrow)</div>
      <div class="step">Scroll down and tap "Add to Home Screen"</div>
      <div class="step">Tap "Add" in the top right</div>
    </div>

    <div class="section">
      <h2>Alternative: Clear All Data</h2>
      <p>If reinstalling doesn't work, try clearing all app data:</p>
      <button onclick="clearAll()">Clear All Data & Reload</button>
      <p style="font-size: 14px; color: #9ca3af; margin-top: 10px;">
        ‚ö†Ô∏è This will log you out and clear all cached data
      </p>
    </div>

    <div class="info">
      <strong>After reinstalling:</strong>
      <ul>
        <li>Try sharing a link from another app</li>
        <li>You should see "Clandestined" in the share menu</li>
        <li>Selecting it should save the article to your reading queue</li>
        <li>Check the browser console for debug logs if it still doesn't work</li>
      </ul>
    </div>

    <div class="section">
      <h2>Debug Info</h2>
      <button onclick="showDebugInfo()">Show Debug Info</button>
      <pre id="debugInfo" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 4px; overflow-x: auto; display: none; margin-top: 10px; font-size: 12px;"></pre>
    </div>
  </div>

  <script>
    function clearAll() {
      if (confirm('This will clear all data and log you out. Continue?')) {
        // Clear all storage
        localStorage.clear()
        sessionStorage.clear()

        // Clear service worker
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(registrations => {
            registrations.forEach(registration => registration.unregister())
          })
        }

        // Clear cache
        if ('caches' in window) {
          caches.keys().then(keys => {
            keys.forEach(key => caches.delete(key))
          })
        }

        alert('Data cleared! The page will now reload.')
        window.location.href = '/'
      }
    }

    function showDebugInfo() {
      const info = {
        userAgent: navigator.userAgent,
        standalone: window.matchMedia('(display-mode: standalone)').matches,
        serviceWorkerSupported: 'serviceWorker' in navigator,
        shareSupported: 'share' in navigator,
        currentURL: window.location.href,
        manifestURL: document.querySelector('link[rel="manifest"]')?.href || 'Not found'
      }

      // Check if service worker is registered
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          info.serviceWorkerRegistered = registrations.length > 0
          info.serviceWorkerCount = registrations.length

          const debugElement = document.getElementById('debugInfo')
          debugElement.textContent = JSON.stringify(info, null, 2)
          debugElement.style.display = 'block'
        })
      } else {
        const debugElement = document.getElementById('debugInfo')
        debugElement.textContent = JSON.stringify(info, null, 2)
        debugElement.style.display = 'block'
      }
    }
  </script>
</body>
</html>
